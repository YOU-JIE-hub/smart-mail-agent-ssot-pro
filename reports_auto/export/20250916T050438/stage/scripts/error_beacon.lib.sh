beacon_init(){ : "${SMA_BEACON_DIR:=reports_auto}"; mkdir -p "$SMA_BEACON_DIR"; }
beacon_record_run(){ local d="$1"; beacon_init; d="$(cd "$d"&&pwd)"; printf "%s\n" "$d" > "$SMA_BEACON_DIR/LAST_RUN_DIR.txt"; ln -sfn "$d" "$SMA_BEACON_DIR/LATEST" 2>/dev/null||true; command -v wslpath >/dev/null 2>&1 && printf "file://%s\n" "$(wslpath -w "$d")" > "$SMA_BEACON_DIR/LAST_RUN_DIR.winuri" 2>/dev/null||true; }
beacon_record_error(){ local d="$1" e="$2" py="$3"; beacon_init; d="$(cd "$d"&&pwd)"; { echo "RUN_DIR=$d"; echo "ERR_FILE=$d/$(basename "$e")"; echo "PY_LAST=$d/$(basename "$py")"; } > "$SMA_BEACON_DIR/LAST_ERROR_POINTERS.txt"; ln -sfn "$d" "$SMA_BEACON_DIR/LAST_ERROR" 2>/dev/null||true; command -v wslpath >/dev/null 2>&1 && printf "file://%s\n" "$(wslpath -w "$d")" > "$SMA_BEACON_DIR/LAST_ERROR_DIR.winuri" 2>/dev/null||true; }
