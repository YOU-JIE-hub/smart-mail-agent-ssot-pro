#!/usr/bin/env python3
# 檔案位置
# src/smart_mail_agent/cli/spamcheck.py
# 模組用途
# 簡易 spam 檢查 CLI。

from __future__ import annotations

import argparse
import json
from pathlib import Path

from smart_mail_agent.spam.ens import SpamEnsemble


def main() -> None:
    """
    參數: 無（命令列解析）
    回傳: None
    """
    ap = argparse.ArgumentParser("sma-spamcheck")
    ap.add_argument("--text")
    ap.add_argument("--file")
    args = ap.parse_args()

    if not (args.text or args.file):
        ap.error("must provide --text or --file")

    text = args.text or Path(args.file).read_text(encoding="utf-8", errors="ignore")
    res = {"proba": SpamEnsemble().predict_proba(text)}
    print(json.dumps(res, ensure_ascii=False, indent=2))


if __name__ == "__main__":
    main()
